当然，没问题。为你量身打造一份专业、清晰的 Markdown 格式产品需求文档（PRD）。

这份文档将作为你开发过程中的核心指南，它详细记录了我们讨论过的所有功能、技术规格和开发步骤。你可以将以下内容直接复制到一个新的 `.md` 文件中（例如 `prd.md`），然后就可以开始你的开发之旅了！

---

```markdown
# AI 原生笔记本 (三栏版) - 产品需求文档 (PRD)

**版本:** 1.0
**日期:** 2023-10-27
**作者:** AI 全栈开发专家 & 需求分析师

---

## 1. 产品概述 (Overview)

本项目旨在开发一个完全在浏览器中运行的三栏式 AI 笔记本 Web 应用。它为用户提供了一个无需注册、打开即用的个人知识管理工具。核心特色在于深度集成了 AI 功能，允许用户不仅能生成内容，还能与自己所有的笔记进行智能对话。所有数据将安全地存储在用户本地浏览器中，确保了隐私和简便性。

---

## 2. 核心功能需求 (Functional Requirements)

### 2.1 界面布局
-   [x] **三栏布局:**
    -   **左侧导航面板:** 用于功能导航和笔记本（文件夹）层级管理。
    -   **中间笔记列表:** 展示当前选中笔记本下的所有笔记条目。
    -   **右侧内容编辑器:** 用于显示和编辑当前选中的笔记正文。

### 2.2 笔记与组织管理
-   [x] **笔记本管理:** 用户可以创建、重命名、删除可无限层级嵌套的笔记本（文件夹）。
-   [x] **笔记管理:** 用户可以在指定的笔记本下创建、编辑和删除笔记。
-   [x] **树状结构视图:** 在左侧面板以可折叠的树状形式展示所有笔记本和笔记的层级关系。
-   [x] **笔记排序:** 在中间笔记列表，用户可以按照笔记的“修改时间”、“创建时间”或“标题”进行排序。

### 2.3 内容编辑
-   [x] **富文本编辑:** 编辑器支持基础的文本格式化，包括：
    -   标题 (H1, H2, H3)
    -   加粗
    -   斜体
    -   无序列表
    -   有序列表

### 2.4 🤖 AI 核心功能
-   [x] **AI 交互入口:** 在左侧面板提供一个“AI 对话”按钮，点击后弹出交互模态框（Modal）。
-   [x] **AI 内容生成:** 在 AI 模态框中，用户可以输入一个主题或指令，AI 将生成相应的大纲或完整文章。用户可选择将生成内容一键创建为一篇新笔记。
-   [x] **AI 智能问答 (与笔记对话):** 在 AI 模态框中，用户可以提出问题。AI 将基于用户本地存储的**所有笔记内容**作为上下文进行回答。

### 2.5 系统与数据
-   [x] **API Key 管理:** 提供一个设置界面，允许用户输入、保存和更新自己的 OpenAI API Key。
-   [x] **本地存储:** 应用的所有数据，包括笔记、笔记本结构和用户 API Key，均使用浏览器的 `localStorage` 进行存储。**无需用户注册或登录。**

### 2.6 暂不实现的功能 (v1.0 Out of Scope)
-   [ ] 行内 AI 编辑 (选中文字进行润色、总结等)。
-   [ ] 高级编辑器功能 (文字颜色、背景高亮、待办事项 Checkbox 等)。
-   [ ] 笔记历史版本控制。
-   [ ] 云端同步与多设备访问。
-   [ ] 用户账户系统。

---

## 3. 技术规格 (Technical Specifications)

### 3.1 前端 (Frontend)

#### 3.1.1 页面/组件结构 (Components)

| 组件名              | 描述                                                                                                                                                    |
| :------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `App.vue`           | 应用根组件。负责实现三栏布局，并管理各组件间的状态通信。                                                                                                     |
| `LeftSidebar.vue`   | 左侧边栏。包含全局操作按钮（新建、AI对话、设置）和用于展示笔记本层级的**树形控件 (Tree)**。负责处理笔记本的增删改操作。                       |
| `NoteList.vue`      | 中间笔记列表。根据左侧选择的笔记本 ID，筛选并展示笔记列表。包含排序下拉菜单。点击笔记时，向父组件派发事件。                                          |
| `Editor.vue`        | 右侧编辑器。接收笔记 ID，加载并使用 **TipTap** 编辑器展示笔记内容。实现内容变化时**自动保存**的逻辑。                                                            |
| `AiModal.vue`       | AI 交互模态框。包含输入框和对话历史。负责封装对 OpenAI API 的调用逻辑，处理内容生成和智能问答两种场景。                                                     |
| `SettingsModal.vue` | 设置模态框。提供输入框用于保存用户的 OpenAI API Key到 `localStorage`。                                                                                   |

#### 3.1.2 关键用户流程 (User Flow)

1.  **加载与渲染:** 应用启动时，从 `localStorage` 读取 `notebookTree` 和 `apiKey`。`LeftSidebar.vue` 使用 `notebookTree` 数据渲染出文件树。
2.  **笔记导航:** 用户在左侧文件树点击一个笔记本 -> `App.vue` 捕获事件 -> `NoteList.vue` 接收到笔记本 ID，重新渲染笔记列表。
3.  **笔记编辑:** 用户在中间列表点击一个笔记 -> `App.vue` 捕获事件 -> `Editor.vue` 接收到笔记 ID，加载内容到编辑器 -> 用户输入时，内容自动保存回 `localStorage`。
4.  **与笔记对话 (AI):** 用户点击 "AI 对话" 按钮 -> `AiModal.vue` 弹出 -> 用户输入问题 -> JS 脚本**遍历本地所有笔记，拼接成一个长文本上下文** -> 将上下文和问题一起封装成 Prompt 发送给 OpenAI -> 在模态框中展示 AI 的回答。

#### 3.1.3 数据交互 (Data Interaction)

-   **本地存储 (`localStorage`):**
    -   **读:** 应用启动时调用 `loadData()` 函数。
    -   **写:** 任何对笔记/笔记本的增删改操作后，调用 `saveData(data)` 函数将最新的数据对象序列化为 JSON 字符串并存入。
-   **外部 API (`OpenAI`):**
    -   **Endpoint:** `POST https://api.openai.com/v1/chat/completions`
    -   **请求头:** `Authorization: Bearer [用户保存在本地的API_KEY]`
    -   **请求体 (示例 - 与笔记对话):**
        ```json
        {
          "model": "gpt-3.5-turbo",
          "messages": [
            {
              "role": "system",
              "content": "你是一个智能笔记助手。以下是用户的所有笔记内容，请根据这些内容回答用户的问题：\n\n[此处拼接所有笔记的标题和内容...]"
            },
            {
              "role": "user",
              "content": "[用户的具体问题，例如：我关于‘三体’的读书笔记里写了什么？]"
            }
          ]
        }
        ```
    -   ⚠️ **注意:** 此方法受限于模型的 Token 上下文窗口大小。当笔记内容过多时可能需要进行截断或优化。

### 3.2 后端 (Backend)
-   **无。** 本项目为纯前端应用，不涉及后端服务器开发。

### 3.3 数据模型 (Data Models in `localStorage`)
-   **Key:** `notebookTree`
-   **Value (JSON 结构):** 一个代表文件树的数组，数组项可以是文件夹或笔记。
    ```json
    [
      {
        "id": "uuid-folder-1",
        "name": "读书笔记",
        "type": "folder",
        "createdAt": "2023-10-27T12:00:00Z",
        "children": [
          {
            "id": "uuid-note-1",
            "name": "关于《三体》的思考",
            "parentId": "uuid-folder-1",
            "type": "note",
            "content": "<p>宇宙就像一片黑暗森林...</p>",
            "createdAt": "2023-10-27T12:05:00Z",
            "updatedAt": "2023-10-27T12:10:00Z"
          }
        ]
      },
      {
        "id": "uuid-note-2",
        "name": "一个顶级笔记",
        "parentId": null,
        "type": "note",
        "content": "<p>这个笔记不属于任何文件夹。</p>",
        "createdAt": "2023-10-28T10:00:00Z",
        "updatedAt": "2023-10-28T10:00:00Z"
      }
    ]
    ```
-   **Key:** `userApiKey`
-   **Value:** 用户的 OpenAI API Key 字符串，例如 `"sk-..."`。

---

## 4. 技术栈建议 (Tech Stack Suggestion)

| 类别            | 技术/库                                                       | 理由                                                                |
| :-------------- | :------------------------------------------------------------ | :------------------------------------------------------------------ |
| **JS 框架**     | **Vue.js 3 (Composition API)**                                | 对初学者友好，响应式系统强大，组合式 API 有利于逻辑复用。             |
| **UI 组件库**   | **Element Plus**                                              | 提供高质量、开箱即用的 `Tree` (树)、 `Dialog` (对话框) 等复杂组件，极大加速开发。 |
| **富文本编辑器**| **TipTap**                                                    | 基于 Prosemirror，现代、无头 (Headless)、可扩展性强，与 Vue 集成良好。   |
| **HTTP 客户端** | **Axios**                                                     | 发送网络请求到 OpenAI API 的行业标准，简单易用。                    |
| **唯一 ID**      | **uuid**                                                      | 用于为每个新创建的笔记本和笔记生成唯一的 `id`。 (`npm install uuid`) |
| **构建工具**    | **Vite**                                                      | `create-vue` 脚手架默认集成，提供极速的开发服务器和构建体验。         |

---

## 5. 开发步骤建议 (Development Roadmap)

1.  **[ ] 步骤一：项目初始化与布局**
    -   使用 `npm create vue@latest` 创建 Vue 3 + Vite 项目。
    -   安装 `element-plus`, `tiptap`, `axios`, `uuid` 等依赖。
    -   在 `App.vue` 中使用 Element Plus 的 `<el-container>` 或 CSS Flexbox 搭建稳固的三栏布局框架。

2.  **[ ] 步骤二：左侧边栏与数据结构**
    -   定义好 `localStorage` 中的数据模型。
    -   编写 `storage.js` 工具模块，封装 `loadData()` 和 `saveData()` 方法。
    -   在 `LeftSidebar.vue` 中，使用 `<el-tree>` 组件并传入模拟数据，实现文件树的展示。
    -   实现文件树节点的增、删、改功能，并确保每次操作都调用 `saveData()` 持久化。

3.  **[ ] 步骤三：笔记列表联动**
    -   在 `NoteList.vue` 中，实现根据左侧选中的笔记本 ID，动态筛选并展示笔记列表。
    -   添加排序功能的 UI 和逻辑。

4.  **[ ] 步骤四：编辑器核心功能**
    -   在 `Editor.vue` 中集成 TipTap 编辑器。
    -   实现点击笔记列表项后，将对应笔记的 `content` 加载到 TipTap。
    -   监听 TipTap 的 `update` 事件，通过防抖 (debounce) 机制实现自动保存。

5.  **[ ] 步骤五：AI 功能集成 (生成内容)**
    -   创建 `AiModal.vue` 和 `SettingsModal.vue`。
    -   完成 API Key 的设置与本地存取。
    -   实现 AI 内容生成流程：用户输入 prompt -> 调用 OpenAI API -> 将返回结果填充到新笔记中。

6.  **[ ] 步骤六：高级 AI 功能 (与笔记对话)**
    -   扩展 `AiModal.vue`，实现“与笔记对话”的逻辑。重点是编写在本地拼接所有笔记内容作为上下文的函数。

7.  **[ ] 步骤七：优化与收尾**
    -   完善所有 UI 细节，添加加载状态（Loading）、错误提示、删除确认等。
    -   进行全面的功能测试，确保所有交互流畅无误。
```